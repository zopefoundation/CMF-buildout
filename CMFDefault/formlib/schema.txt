Utilities


  Testing ProxyFieldProperty:

    Setting up content and adapter::

      >>> from OFS.PropertyManager import PropertyManager
      >>> class FooContent(PropertyManager):
      ...     _properties=({'id':'foo_prop', 'type': 'string'},)
      ...     foo_text = ''
      ...     foo_datetime = None
      ...     foo_set = ()
      ...     foo_prop = ''

      >>> from zope.interface import Interface
      >>> from zope import schema
      >>> class IFooContentView(Interface):
      ...     foo_text = schema.Text()
      ...     foo_datetime = schema.Datetime()
      ...     foo_set = schema.Set()
      ...     foo_prop = schema.Text()

      >>> from Products.CMFDefault.formlib.schema import ProxyFieldProperty
      >>> class FooContentAdapter(object):
      ... 
      ...     foo_text = ProxyFieldProperty(IFooContentView['foo_text'])
      ...     foo_datetime = ProxyFieldProperty(IFooContentView['foo_datetime'])
      ...     foo_set = ProxyFieldProperty(IFooContentView['foo_set'])
      ...     foo_prop = ProxyFieldProperty(IFooContentView['foo_prop'])
      ... 
      ...     def __init__(self, context):
      ...         self.context = context
      ...         self.encoding = 'utf-8'

      >>> content = FooContent()
      >>> adapter = FooContentAdapter(content)

    unicode is mapped to str::

      >>> foo_text = u'foo'
      >>> adapter.foo_text = foo_text
      >>> content.foo_text
      'foo'
      >>> adapter.foo_text == foo_text
      True

    datetime is mapped to DateTime::

      >>> from datetime import datetime
      >>> from DateTime.DateTime import DateTime
      >>> from Products.PluginIndexes.DateIndex.DateIndex import Local
      >>> foo_datetime = datetime(2002, 2, 2, 2, 2, 2, tzinfo=Local)
      >>> adapter.foo_datetime = foo_datetime
      >>> isinstance(content.foo_datetime, DateTime)
      True
      >>> adapter.foo_datetime == foo_datetime
      True

    set is mapped to tuple::

      >>> foo_set = set([3, 1, 4])
      >>> adapter.foo_set = foo_set
      >>> content.foo_set
      (1, 3, 4)
      >>> adapter.foo_set == foo_set
      True

    PropertyManager properties use _setProperty::

      >>> foo_prop = u'foo'
      >>> adapter.foo_prop = foo_text
      >>> content.foo_prop
      'foo'
      >>> adapter.foo_prop == foo_prop
      True
